<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and minor style adjustments */
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
            background-color: #111827; /* Dark background */
            color: #e5e7eb;
        }
        #wind-arrow {
             transition: transform 0.5s ease-out;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div id="weather-container" class="max-w-7xl mx-auto">

        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 id="location-name" class="text-3xl sm:text-4xl font-bold tracking-wider text-white uppercase">Loading Weather...</h1>
        </header>

        <!-- Main Weather Display -->
        <main id="weather-main" class="bg-gray-800/50 rounded-lg p-6 shadow-lg flex flex-col sm:flex-row items-center justify-around text-center mb-8 hidden">
            <!-- Current Conditions -->
            <div class="flex flex-col items-center mb-6 sm:mb-0">
                <h2 class="text-xl text-gray-400">Now</h2>
                <div id="current-icon" class="w-24 h-24 sm:w-32 sm:h-32 my-2"></div>
                <p id="current-temp" class="text-5xl sm:text-6xl font-bold text-white"></p>
                <p id="current-condition" class="text-lg text-gray-300"></p>
                <!-- Wind Speed and Direction -->
                <div class="flex items-center justify-center mt-4">
                    <svg id="wind-arrow" class="w-6 h-6 mr-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    <p id="current-wind" class="text-lg text-gray-300"></p>
                </div>
            </div>

            <!-- Daily Summary -->
            <div class="text-lg">
                <p class="mb-2"><span class="font-bold text-white">High:</span> <span id="today-high" class="text-gray-300"></span></p>
                <p class="mb-2"><span class="font-bold text-white">Low:</span> <span id="today-low" class="text-gray-300"></span></p>
                <p class="mb-2"><span class="font-bold text-white">Wind:</span> <span id="today-wind" class="text-gray-300"></span></p>
                <p><span class="font-bold text-white">Precipitation:</span> <span id="today-precip" class="text-gray-300"></span></p>
            </div>
        </main>

        <!-- 7-Day Forecast -->
        <div id="forecast-container" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4 text-center hidden">
            <!-- Forecast items will be loaded here by JavaScript -->
        </div>
        
        <!-- Loading / Error State -->
        <div id="message-container" class="text-center p-12 text-gray-400"></div>

    </div>
    
    <script src="config.js"></script>
    <script>
        // --- CONFIGURATION ---
        // All settings are now managed in config.js under the 'weatherConfig' object.
        const LATITUDE = CONFIG.weatherConfig.latitude;
        const LONGITUDE = CONFIG.weatherConfig.longitude;
        const LOCATION_NAME = CONFIG.weatherConfig.locationName;
        const REFRESH_INTERVAL_MINUTES = CONFIG.weatherConfig.refreshIntervalMinutes;
        // -------------------

        // WMO Weather code to icon mapping
        const WEATHER_ICONS = {
            0: { desc: "Clear sky", icon: "‚òÄÔ∏è" },
            1: { desc: "Mainly clear", icon: "üå§Ô∏è" },
            2: { desc: "Partly cloudy", icon: "‚õÖÔ∏è" },
            3: { desc: "Overcast", icon: "‚òÅÔ∏è" },
            45: { desc: "Fog", icon: "üå´Ô∏è" },
            48: { desc: "Depositing rime fog", icon: "üå´Ô∏è" },
            51: { desc: "Light drizzle", icon: "üíß" },
            53: { desc: "Moderate drizzle", icon: "üíß" },
            55: { desc: "Dense drizzle", icon: "üíß" },
            56: { desc: "Light freezing drizzle", icon: "ü•∂" },
            57: { desc: "Dense freezing drizzle", icon: "ü•∂" },
            61: { desc: "Slight rain", icon: "üåßÔ∏è" },
            63: { desc: "Moderate rain", icon: "üåßÔ∏è" },
            65: { desc: "Heavy rain", icon: "üåßÔ∏è" },
            66: { desc: "Light freezing rain", icon: "ü•∂" },
            67: { desc: "Heavy freezing rain", icon: "ü•∂" },
            71: { desc: "Slight snow fall", icon: "‚ùÑÔ∏è" },
            73: { desc: "Moderate snow fall", icon: "‚ùÑÔ∏è" },
            75: { desc: "Heavy snow fall", icon: "‚ùÑÔ∏è" },
            77: { desc: "Snow grains", icon: "‚ùÑÔ∏è" },
            80: { desc: "Slight rain showers", icon: "üå¶Ô∏è" },
            81: { desc: "Moderate rain showers", icon: "üå¶Ô∏è" },
            82: { desc: "Violent rain showers", icon: "üå¶Ô∏è" },
            85: { desc: "Slight snow showers", icon: "üå®Ô∏è" },
            86: { desc: "Heavy snow showers", icon: "üå®Ô∏è" },
            95: { desc: "Thunderstorm", icon: "‚õàÔ∏è" },
            96: { desc: "Thunderstorm with slight hail", icon: "‚õàÔ∏è" },
            99: { desc: "Thunderstorm with heavy hail", icon: "‚õàÔ∏è" },
        };
        
        /**
         * Converts wind direction from degrees to a cardinal direction.
         * @param {number} degree - The wind direction in degrees.
         * @returns {string} The cardinal direction (e.g., N, NE, S).
         */
        function degreesToCardinal(degree) {
            const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
            const index = Math.round(degree / 22.5) % 16;
            return directions[index];
        }


        /**
         * Fetches and displays weather data.
         */
        async function loadWeatherData() {
            const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${LATITUDE}&longitude=${LONGITUDE}&current=temperature_2m,weather_code,wind_speed_10m,wind_direction_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,wind_speed_10m_max,wind_direction_10m_dominant&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=auto`;
            
            const messageContainer = document.getElementById('message-container');
            const weatherMain = document.getElementById('weather-main');
            const forecastContainer = document.getElementById('forecast-container');

            messageContainer.innerHTML = '<span>Loading fresh weather data...</span>';
            weatherMain.classList.add('hidden');
            forecastContainer.classList.add('hidden');

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`Weather API responded with status: ${response.status}`);
                }
                const data = await response.json();

                if (!data.current || !data.daily) {
                    throw new Error("API response is missing required weather data.");
                }

                // --- Update UI ---
                document.getElementById('location-name').textContent = LOCATION_NAME;
                
                // Current Conditions
                const currentCode = data.current.weather_code;
                document.getElementById('current-temp').textContent = `${Math.round(data.current.temperature_2m)}¬∞F`;
                document.getElementById('current-icon').innerHTML = `<div class="text-7xl sm:text-8xl">${WEATHER_ICONS[currentCode]?.icon || '‚ùì'}</div>`;
                document.getElementById('current-condition').textContent = WEATHER_ICONS[currentCode]?.desc || 'Unknown';
                document.getElementById('current-wind').textContent = `${Math.round(data.current.wind_speed_10m)} mph`;
                document.getElementById('wind-arrow').style.transform = `rotate(${data.current.wind_direction_10m}deg)`;


                // Today's Summary (from daily forecast index 0)
                document.getElementById('today-high').textContent = `${Math.round(data.daily.temperature_2m_max[0])}¬∞F`;
                document.getElementById('today-low').textContent = `${Math.round(data.daily.temperature_2m_min[0])}¬∞F`;
                const windDir = degreesToCardinal(data.daily.wind_direction_10m_dominant[0]);
                document.getElementById('today-wind').textContent = `${Math.round(data.daily.wind_speed_10m_max[0])} mph ${windDir}`;
                document.getElementById('today-precip').textContent = `${data.daily.precipitation_probability_max[0]}%`;

                // 7-Day Forecast
                forecastContainer.innerHTML = ''; // Clear previous forecast
                for (let i = 0; i < 7; i++) {
                    const date = new Date(data.daily.time[i]);
                    const dayName = i === 0 ? 'Today' : date.toLocaleDateString('en-US', { weekday: 'short' });
                    const forecastCode = data.daily.weather_code[i];

                    const forecastItem = document.createElement('div');
                    forecastItem.className = 'bg-gray-800/50 rounded-lg p-4';
                    forecastItem.innerHTML = `
                        <p class="font-bold text-lg">${dayName}</p>
                        <div class="text-5xl my-2">${WEATHER_ICONS[forecastCode]?.icon || '‚ùì'}</div>
                        <p class="text-white">${Math.round(data.daily.temperature_2m_max[i])}¬∞</p>
                        <p class="text-gray-400">${Math.round(data.daily.temperature_2m_min[i])}¬∞</p>
                    `;
                    forecastContainer.appendChild(forecastItem);
                }

                // Show the weather content
                messageContainer.innerHTML = '';
                weatherMain.classList.remove('hidden');
                forecastContainer.classList.remove('hidden');

            } catch (error) {
                console.error("Error loading weather data:", error);
                messageContainer.innerHTML = `<span class="text-red-400">Error: Could not load weather data.</span>`;
            }
        }

        // Load data on page load and set an interval to refresh it
        document.addEventListener('DOMContentLoaded', () => {
            loadWeatherData();
            setInterval(loadWeatherData, REFRESH_INTERVAL_MINUTES * 60 * 1000);
        });
    </script>
</body>
</html>
