<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Notes from Google Sheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            /* Applying the handwritten font */
            font-family: 'Kalam', cursive;
        }
        /* Simple animation for note appearance */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .note-item {
            animation: fadeIn 0.5s ease-out;
            /* Adding a transition for a smoother hover effect */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .note-item:hover {
            /* Make the note slightly larger and pop out on hover */
            transform: scale(1.05) !important; /* Use !important to override inline style */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
    </style>
</head>
<body class="bg-amber-100 text-gray-900">

    <div class="container mx-auto p-4 md:p-8 max-w-full">

        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-8xl font-bold text-amber-800">NOTABLE ADDRESSES</h1>
        </header>

        <!-- Saved Notes List -->
        <div>
            <!-- Removed the "Notes" heading for a cleaner look -->
            <div id="notesList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                <!-- Notes will be dynamically inserted here -->
            </div>
        </div>

    </div>

    <!-- Footer with Color Key -->
    <footer class="text-center py-6 mt-8">
        <div class="container mx-auto text-amber-800 font-bold text-xl">
            <span class="inline-flex items-center mr-6">
                <span class="h-5 w-5 rounded-full bg-green-300 mr-3 border border-green-400"></span> Green = General
            </span>
            <span class="inline-flex items-center mr-6">
                <span class="h-5 w-5 rounded-full bg-yellow-300 mr-3 border border-yellow-400"></span> Yellow = Important
            </span>
            <span class="inline-flex items-center">
                <span class="h-5 w-5 rounded-full bg-red-300 mr-3 border border-red-400"></span> Red = Urgent
            </span>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const notesList = document.getElementById('notesList');
            // URL for the Google Sheet CSV - CORRECTED GID
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT0VotPZTFkALWoh6U6g6WnfqsVeltkkjCkd5CBVAHh60e-A63h5HdzaSVamSjkcxveTOfycKZ2K66r/pub?gid=1769339552&single=true&output=csv';

            async function loadNotesFromSheet() {
                notesList.innerHTML = `<div class="text-center text-gray-600 py-4 col-span-full text-2xl">Loading notes...</div>`;
                try {
                    const response = await fetch(sheetUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();
                    const notes = parseCSV(csvText);
                    renderNotes(notes);
                } catch (error) {
                    console.error("Failed to load notes:", error);
                    notesList.innerHTML = `<div class="text-center text-red-500 py-4 col-span-full text-2xl">Failed to load notes. Please check the URL or your network connection.</div>`;
                }
            }
            
            function parseCSV(text) {
                // This function dynamically reads the headers from your sheet.
                // It works correctly as long as 'Address', 'Note', 'priority', and 'Timestamp' headers exist, regardless of their column order.
                const lines = text.trim().split('\n').map(line => line.trim());
                const headers = lines.shift().split(',').map(h => h.trim());

                return lines.map(line => {
                    // This improved parser correctly handles commas within your data fields (e.g., in an address).
                    const values = [];
                    let currentVal = '';
                    let inQuotes = false;
                    for (const char of line) {
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(currentVal);
                            currentVal = '';
                        } else {
                            currentVal += char;
                        }
                    }
                    values.push(currentVal);

                    const noteObject = {};
                    headers.forEach((header, index) => {
                        const key = header.toLowerCase().trim();
                        // Also remove quotes from the value itself
                        const value = values[index] ? values[index].replace(/"/g, '').trim() : '';
                        noteObject[key] = value;
                    });
                    return noteObject;
                });
            }

            function renderNotes(notes) {
                notesList.innerHTML = ''; // Clear current list

                if (!notes || notes.length === 0) {
                    notesList.innerHTML = `<div class="text-center text-gray-600 py-4 col-span-full text-2xl">No notes found in the spreadsheet.</div>`;
                    return;
                }
                
                // Reverse to show the latest entries from the sheet first (optional)
                notes.reverse();

                notes.forEach(note => {
                    // Skip if address is missing
                    if (!note.address) return;

                    // Determine background color based on priority
                    const priority = (note.priority || '').toLowerCase();
                    let bgColorClass = 'bg-yellow-200'; // Default sticky note color
                    let shadowClass = 'shadow-md';
                    if (priority === 'red') {
                        bgColorClass = 'bg-red-300';
                        shadowClass = 'shadow-lg'; // Make urgent notes pop more
                    } else if (priority === 'yellow') {
                        bgColorClass = 'bg-yellow-300';
                        shadowClass = 'shadow-lg';
                    } else if (priority === 'green') {
                        bgColorClass = 'bg-green-300';
                    }

                    const noteElement = document.createElement('div');
                    noteElement.className = `p-6 rounded-md note-item ${bgColorClass} ${shadowClass} flex flex-col`;

                    // Add a slight random rotation to each note
                    const rotation = (Math.random() * 4) - 2; // Random rotation between -2 and +2 degrees
                    noteElement.style.transform = `rotate(${rotation}deg)`;
                    
                    noteElement.innerHTML = `
                        <div class="flex-grow">
                            <h3 class="font-bold text-4xl text-gray-800 break-words">${escapeHTML(note.address.toUpperCase())}</h3>
                            <p class="text-gray-800 mt-3 whitespace-pre-wrap break-words text-2xl">${escapeHTML((note.note || '').toUpperCase())}</p>
                        </div>
                        <p class="text-lg text-gray-600 text-right mt-5 pt-3 border-t border-black/10">${escapeHTML((note.timestamp || '').toUpperCase())}</p>
                    `;
                    notesList.appendChild(noteElement);
                });
            }

            function escapeHTML(str) {
                const div = document.createElement('div');
                div.appendChild(document.createTextNode(str));
                return div.innerHTML;
            }
            
            // Initial load
            loadNotesFromSheet();
        });
    </script>

</body>
</html>