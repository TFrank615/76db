<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Notes from Google Sheet (Mobile)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            /* Applying the handwritten font */
            font-family: 'Kalam', cursive;
        }
        /* Simple animation for note appearance */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .note-item {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-amber-100 text-gray-900">

    <div class="container mx-auto p-4 max-w-full">

        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-5xl font-bold text-amber-800">NOTABLE ADDRESSES</h1>
        </header>

        <!-- Saved Notes List -->
        <div>
            <div id="notesList" class="grid grid-cols-1 gap-4">
                <!-- Notes will be dynamically inserted here -->
            </div>
        </div>

    </div>

    <!-- Footer with Color Key -->
    <footer class="text-center py-4 mt-6">
        <div class="container mx-auto text-amber-800 font-bold text-sm">
            <div class="flex flex-col space-y-2">
                <span class="inline-flex items-center justify-center">
                    <span class="h-4 w-4 rounded-full bg-green-300 mr-2 border border-green-400"></span> Green = General
                </span>
                <span class="inline-flex items-center justify-center">
                    <span class="h-4 w-4 rounded-full bg-yellow-300 mr-2 border border-yellow-400"></span> Yellow = Important
                </span>
                <span class="inline-flex items-center justify-center">
                    <span class="h-4 w-4 rounded-full bg-red-300 mr-2 border border-red-400"></span> Red = Urgent
                </span>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const notesList = document.getElementById('notesList');
            // URL for the Google Sheet CSV
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT0VotPZTFkALWoh6U6g6WnfqsVeltkkjCkd5CBVAHh60e-A63h5HdzaSVamSjkcxveTOfycKZ2K66r/pub?gid=1769339552&single=true&output=csv';

            async function loadNotesFromSheet() {
                notesList.innerHTML = `<div class="text-center text-gray-600 py-4 text-lg">Loading notes...</div>`;
                try {
                    const response = await fetch(sheetUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();
                    const notes = parseCSV(csvText);
                    renderNotes(notes);
                } catch (error) {
                    console.error("Failed to load notes:", error);
                    notesList.innerHTML = `<div class="text-center text-red-500 py-4 text-lg">Failed to load notes. Please check the URL or your network connection.</div>`;
                }
            }
            
            function parseCSV(text) {
                const lines = text.trim().split('\n').map(line => line.trim());
                const headers = lines.shift().split(',').map(h => h.trim());

                return lines.map(line => {
                    const values = [];
                    let currentVal = '';
                    let inQuotes = false;
                    for (const char of line) {
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(currentVal);
                            currentVal = '';
                        } else {
                            currentVal += char;
                        }
                    }
                    values.push(currentVal);

                    const noteObject = {};
                    headers.forEach((header, index) => {
                        const key = header.toLowerCase().trim();
                        const value = values[index] ? values[index].replace(/"/g, '').trim() : '';
                        noteObject[key] = value;
                    });
                    return noteObject;
                });
            }

            function renderNotes(notes) {
                notesList.innerHTML = ''; // Clear current list

                if (!notes || notes.length === 0) {
                    notesList.innerHTML = `<div class="text-center text-gray-600 py-4 text-lg">No notes found.</div>`;
                    return;
                }
                
                notes.reverse();

                notes.forEach(note => {
                    if (!note.address) return;

                    const priority = (note.priority || '').toLowerCase();
                    let bgColorClass = 'bg-yellow-200';
                    if (priority === 'red') {
                        bgColorClass = 'bg-red-300';
                    } else if (priority === 'yellow') {
                        bgColorClass = 'bg-yellow-300';
                    } else if (priority === 'green') {
                        bgColorClass = 'bg-green-300';
                    }

                    const noteElement = document.createElement('div');
                    noteElement.className = `p-4 rounded-md note-item ${bgColorClass} shadow-md flex flex-col`;
                    
                    noteElement.innerHTML = `
                        <div class="flex-grow">
                            <h3 class="font-bold text-2xl text-gray-800 break-words">${escapeHTML(note.address.toUpperCase())}</h3>
                            <p class="text-gray-800 mt-2 whitespace-pre-wrap break-words text-base">${escapeHTML((note.note || '').toUpperCase())}</p>
                        </div>
                        <p class="text-sm text-gray-600 text-right mt-4 pt-2 border-t border-black/10">${escapeHTML((note.timestamp || '').toUpperCase())}</p>
                    `;
                    notesList.appendChild(noteElement);
                });
            }

            function escapeHTML(str) {
                const div = document.createElement('div');
                div.appendChild(document.createTextNode(str));
                return div.innerHTML;
            }
            
            // Initial load
            loadNotesFromSheet();
        });
    </script>

</body>
</html>
